# ---- IPv6 ----
- 변경사항
    - 주소공간 확장
    - 헤더구조 단순화
        - 불필요 필드 제외
        - 옵션 = 모두 확장헤더방식으로 지원
        - 오류제어 등의 오버헤드를 줄여 프로토콜 전송 효율 향상
    - 흐름제어 기능지원
        - flow label 도입 ---> 일정범위 내에서 예측 가능한 데이터 흐름 지원
        - 연관 패킷전송 지원 ---> 하나의 연속 스트림으로 전송
        - 실시간 멀티미디어 응용환경 수용
---
### IPv6 헤더
- 기본헤더
    - version number = 6
    - priority필드
        - 특정 패킷의 우선순위 상향
            - 혼잡제어 유무에 따른 처리
                - 혼잡제어 無
                    - 우선순위 8단계로 구분처리
                - 혼잡제어 有
                    - 구분처리
                        - 인터넷 제어트래픽
                        - 대화식 트레픽
                        - 대용량 전송트래픽
                        - 데이터 트래픽
                        - 필터 트래픽
    - flow label
        - 패킷 구분 ---> IPv4와 차별점
        - 실시간 서비스가 필요한 응용환경에 유용
        - 필드를 지원하지 않는 호스트, 라우터에서 처리
            - 패킷 생성 시 0으로 지정
            - 패킷 중개시 현재값 유지
            - 패킷 수신시 값 무시
        - 0이 아닌 동일번호 패킷 ---> 주요 필드에 대해 동일한 값 ---> 중개 과정 간단 처리 ---> 다른 필드값 확인없이 flow label만 보고 처리
        - 값 선택 랜덤
    - payload length 
        - 헤더 제외한 패킷 크기
    - next header
        - 기본헤더 다음 위치헤더의 유형
        - IPv6의 확장헤더
        - 확장헤더X --> TCP, UDP헤더(상위계층)
    - hop limit 
        - IPv4의 time to live필드와 동일역할
    - source address, destination address
        - IPv6 주소
            - 16비트 숫자 8개를 :으로 구분
            - 축약표기
                - 하나의 0
                - 연속 0그룹을 없애고 :만 남길 수 있음(한번만)
                - 앞자리 0도 축약가능
            - 기본적으로 서로 다른 2가지 유니캐스트 주소지정
                - 전역 유니캐스트 주소
                    - 공용토폴로지 + 사이트 토폴로지(또는 서브넷 ID) + 인터페이스ID
                - 링크로컬 주소
                    - 로컬 네트워크 링크에서만 사용
                    - 링크로컬 접두어(fe80) + 54비트 0 + 인터페이스ID(64비트 하드웨어주소)
            - 사이트 로컬주소
                - 하나의 조직, 회사내에서 유요주소
                - 사이트 로컬 프리픽스(fbc0)
- 확장헤더 소개
    - hop-by-hop options
    - routing
    - fragment
    - destination options
    - authentication
    - encopsulating security payload
---
---
# ---- 이동 IP ----
> 고정통신망에서 유무선이 복합된 이동 광대역통신망으로 진화
- 예시
    - 핸드오버
        - 휴대폰 통화가 기지국을 옮긴다고 끊어지지 않음
        - 전파가 강한쪽 기지국을 사용함
    - 로밍
---
### IP 터널링
- 터널링 원리
    - 헤더 삭제, 변경 없이 앞쪽에 지속적으로 관련 해더를 붙이며 데이터 이동
- 주소 표현
    - 통신할 상대방을 구분하기 위해 주소 필요
    - 이동망환경에서 주소처리
        - 이동위치에서 새로운 IP주소 할당
        - 호스트 고유 주소 유지
    - 기존 IP가 가진 2가지기능
        - 호스트 식별
        - 경로(위치)
    - 에이전트
        > 이동망 환경에서 호스트 이동할 때 추적할 방법
        - 두 종류 주소 사용
            - home address
                - 이동호스트를 위한 고정주소
                - HA(home agent)
                    - 이동 호스트를 위한 고정위치에서 FA로 연결처리
            - COA(care of address)
                - 이동호스트를 위한 가변주소(일시적 할당)
                - FA(foreign agent)
                    - 이동 호스트에서 근접한 FA
                    - COA 관리
                    - HA와의 터널관리
        - 호스트 이동할 때 처리
            - HA 불변 /FA 변함
            - HA와 새로운 FA 사이에 터널설정
        - 패킷 전달과정
            1. 이동호스트를 목적지로 하는 패킷은 HA에게 전달
            2. HA는 FA에게 패킷 전달
            3. FA는 이동 호스트에게 패킷 전달
    - IP 터널
        - 터널 구간에서 IP캡슐링방식으로 패킷중개
            - 원 패킷
                - 송신호스트가 전송, 수신호스트가 수신받는 패킷
            - IP캡슐 패킷
                - 터널구간에서 원패킷을 IP캡슐화
        - 추가된 헤더 목적지에 COA가 들어감(앞부분에 붙음)
        - FA는 헤더 제거 후 (IP헤더+데이터)만 다음으로 전달
---
---
# ---- 기타 네트워크계층 프로토콜 ----
### ARP(address resolution protocol)
- 필요성
    - 실제 통신이 이루어지기 위해 데이터계층 MAC주소를 알아야 가능
    - IP주소 ---> MAC주소 변환
    - 송신 MAC주소
        - ARP request 방송
        - 해당호스트가 자신의 MAC주소를 ARP reply로 회신
- 과도한 트래픽유발 방지를 위해 캐시 사용
---
### RARP(reverse)
- 필요성
    - 하드디스크가 없는 시스템은 자신의 IP주소를 저장할 수 X
        - ROM에 TFTP 등 기본프로토콜만 존재
        - 서버에서 관련정보 받아 메모리에 저장
    - 자신의 H/W주소를 방송 ---> RARP서버가 알려준 IP주소 이용
- 동작
    - 자신의 MAC주소 담아 방송(브로드캐스트)
    - 해당 정보를 가지고 있는 RARP서버 응답
---
### BOOTP, DHCP
- BOOTP
    - DHCP전에 개발된 호스트 구성 프로토콜
- DHCP
    - BOOTP를 바탕으로 개선
    - 호스트 구성 서비스 ---> BOOTP가 갖고 있는 특정 제한 해결
    - 헤더
        - op(메세지 opcode)
            - 1 = BOOTREQUEST
            - 2 = BOOTREPLY
        - htype(H/W주소 type)
        - hlen(H/W주소 길이)
        - hops
            - client = 0으로 셋팅
            - relay agent인 경우 옵션으로 0설정
        - xid(transcation ID)
            - 클라이언트가 선택한 랜덤숫자에 대한 응답으로 같은 값 설정
        - secs
            - 클라이언트가 쓰는 초단위
        - flags 
        - ciaddr(client IP주소)
        - yiaddr(your client IP주소)
        - siaddr(부트스트랩에서 사용할 다음 서버 IP주소)
        - giaddr(relay agent IP주소)
        - chaddr(클라이언트 H/W주소)
        - sname(optional 서버 호스트이름)
        - file(부트 파일이름)
        - options(optional 매개변수 필드)
    - 기능
        - 설정 파라미터에 대한 저장소역할
            - 서버에서 관련된 정보들을 가지고 있다가 요청이 오면 제공
            - 클라이언트마다 key-value 쌍으로 저장
        - 네트워크주소 동적할당
            - 한정된 IP주소를 가지고 다수 호스트에게 IP주소를 부여했다가 다시 회수하는 방식으로 공유가능
            - lease
    - 메시지
        - DHCPDISCOVER
            - 클라이언트가 브로드캐스트로 사용하는 서버들 확인
        - DHCPOFFER
            - 서버가 클라이언트에게 정보설정에 대한 OFFER
        - DHCPREQUEST
            - 클라이언트가 서버에게 요청
        - DHCPACK
        - DHCPNAK
        - DHCPDECLINE
        - DHCPRELEASE
        - DHCPINFORM
    - 동작
        1. DHCPDISCOVER를 브로드캐스팅 ---> 여러 서버에게 도착
        2. 각 서버는 DHCPOFFER 보냄(구성설정)
        3. 클라이언트는 먼저 들어온 응답의 서버를 선택
        4. 선택되지 않은 서버 무시(NAK)
```
BOOTP, DHCP의 유사점
* 서버와 클라이언트간에 메세지 교환 형식 구조
* 클라이언트/서버통신에 잘 알려진 UDP포트(67,68)사용
* 구성 서비스의 필수적인 부분으로 IP주소 배포
    - 시작하는 동안 IP주소를 클라이언트에 할당
```
- 차이점
    |  <center>**BOOTP**</center> |  <center>**DHCP**</center> |
    |:--------|:--------|
    |- 제한된부팅기능사용<br>- 워크스테이션 구성하기 위해 사용 |- (로컬 하드드라이브 + 모든 부팅기능) 有<br>- 위치를 자주 이동하는 네트워크에 연결된 컴퓨터(휴대용장치) 구성하기 위해 사용 |
    |IP주소 임대 = 기본 ``30일`` 만료| IP주소 임대 = 기본 ``8일`` 만료 |
    |``vend(64비트)``라는 제한된 수 클라이언트 구성 매개변수 지원 |``option``이라는 더 크고 확장가능한 클라이언트 구성 매개변수 집합 지원|
    |2단계 부트스트랩 구성프로세스<br>- 클라이언트가 BOOTP서버에 연결, 주소결정과 부팅파일이름 선택<br>- 클라이언트가 TFTP서버에 연결하여 부팅이미지 파일전송 수행|- DHCP클라이언트가 DHCP서버와 협상하여 IP주소 결정<br>-네트워크 작업에 필요한 다른 모든 초기 구성정보를 얻는 단일 단계 부팅구성 프로세스|
    |BOOTP클라이언트가 BOOTP서버와 구성을 재바인딩, 갱신X<br>(시스템이 재시작시 제외)|- 시스템 재시작 시 DHCP 클라이언트, 서버가 구성을 재바인딩, 갱신 필요X<br>- 클라이언트가 설정된 시간 간격에 재바인딩상태로 자동전환 ---> DCHP서버와 임대된 주소할당 갱신|
---
### IMCP(internet control message protocol)
- 메시지
    - echo request, reply
        - ping프로그램
    - destination unreachable
        - 수신호스트에 접근 불가
    - source quench
        - 네트워크에 필요한 자원 부족으로 패킷 폐기
    - time exceeded
        - 시간초과로 패킷 폐기
    - timestamp request, reply
        - 네트워크 지연측정
- 헤더
    - 처음 8바이트 = 모든 메시지에 반드시 포함
    - type
        - 메시지 구분
    - code
        - 메시지 내용에 대한 자세한 정보
    - checksum
        - 전체 메시지에 대한 기능
    - ICMP 메시지 내용 1
        - 메시지 종류에 따라 값 결정
    - ICMP 메시지 내용 2
        - 오류 원인 제공한 IP패킷 헤더와 이어지는 8byte 정보 포함
- ICMP메시지 전송
    - 기능적으로 IPㅍ로토콜과 같은 계층 역할
    - 메시지는 IP프로토콜에 캡슐화되어 전송
---
### IGMP(internet group management protocol)
- 멀티캐스팅
    - 특정 그룹에 속한 모든 호스트에게 메시지 전송
- 그룹관리
    - 그룹 생성, 제거, 참가, 탈퇴
    - 멀티캐스팅을 지원하기 위한 방안
        - 멀티캐스트 그룹 주소 표기방법 통일
        - 라우터가 멀티캐스트주소와 이 그룹에 속하는 호스트 사이 연관성 처리(특히 동적추가, 삭제 환경 대응)
        - 효율적인 멀티캐스트 라우팅 알고리즘
            - 모든 멤버에게 전달 가능한 가장 짧은 경로 선택방안
- 헤더
    - 질의메시지
        - 라우터에서 호스트로 전달
    - 보고 메시지
        - 질의 메시지에 대한 응답으로 호스트가 회신
    - IGMP 버전2 메시지형식
        - type
            - 0x11(질의 메시지)
            - 0x16(보고 메시지)
            - 0x17(그룹 탈퇴 관련 메시지)
        - max response time
            - 질의메시지에서 사용
            - 보고메시지가 전동되어야 하는 max(응답시간)
        - group address
            - 질의메시지 = 0으로 채움
            - 보고 메시지 = 호스트가 가입원하는 그룹 주소 표기
- 메시지 전송
    - IP프로토콜과 동등한 계층 기능 수행
    - IP 패킷에 캡슐화 되어 전송