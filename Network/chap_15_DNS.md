# ---- 도메인 서비스 ----
- IP주소
    - 32비트
    - 사용자 편의를 위해 8비트(10진수)*4개로 표현
    - 주소클래스
        |클래스|IP주소범위|네트워크주소크기|호스트주소크기|
        |:--|:--|:--|:--|
        |A|0~127|7비트|24비트|
        |B|128~191|14|16|
        |C|192~223|21|8|
---
### DNS(domain name system)
> 분산데이터베이스
- 도메인 이름
    - 문자형으로 표기되는 호스트이름
    - 일반사용자가 선호
- IP주소
    - IP프로토콜에서 호스트 구분을 위해 반드시 필요
- DNS 도입전
    - 인터넷 초기에 수작업으로 관리
    - /etc/hosts파일 ---> 파일내용 = (도메인이름, IP주소)
    - 주기적으로 FTP서비스 이용하여 수정된 파일 다운로드
- 컴퓨터 보급에 따른 기존방법 한계
    - 한 시스템에서 모든 호스트 이름, 주소 관리 불가능
    - 도메인 이름 중복 문제
- 해결방안
    - 위임, 계층적 도메인이름
        - ROOT에서 하부로 위임(com, edu, kr...)
        - TLD(top level domain)에서 하위로 계속 위임(co.kr, ac.kr...)
        - 위임받은 기관에서 자신의 도메인에 속한 호스트이름, IP주소관리(korea.co.kr에서 info1 관리)
    - 분산DB
        - 각 기관에서 관리하고 있는 분산 DB를 연계, 서비스제공
- 해석기(resolver)
    - IP주소를 얻고자 하는 응용프로그램이 호출
    - 응용프로그램은 해석기에게 도메인이름을 매개변수로 제공
    - 해석기는 DNS프로토콜 이용 ---> DNS서버에 변환요청
- nslookup(dig) 명령어
    - DNS서버 = server.korea.co.kr
    - information.korea.co.kr의 IP주소
    - 사용법 ---> nslookup + 원하는 도메인 ---> 서버+해당주소 반환
- 구성요소
    - 도메인 네임스페이스
        - 트리구조 네임스페이스를 비롯해 데이터에 대한 이름관련 규칙 정의
        - 트리에 연결된 호스트는 자원 레코드로 표현
        - DNS서비스는 자우너 레코드의 특정 유형정보를 얻는 과정
    - 네임서버
        - (도메인 트리구조 + 트리에 보관된 자원 레코드) 관리하는 프로그램
        - 여러 네임서버가 구역을 분할해 전체 도메인 관리
        - 주 네임서버 = 분할구역을 담당
        - 부 네임서버 = 백업용도
        - 캐시에 다른 서버로부터 얻은 정보 임시보관
    - 해석기
        - 클라이언트 요청을 받아 네임서버로부터 정보 얻음
        - 하나 이상의 네임서버와 접촉 가능
        - 캐시에 얻어온 정보 임시보관
---
---
# ----DNS 데이터베이스----
### 도메인 네임스페이스
- DNS가 저장, 관리하는 계층적 DB
- 최상위에 루트 존재 ---> 그 아래로 모든 호스트가 트리구조로 이어짐
- 레이블
    - 이름
    - 최대 63바이트
- 도메인이름
    - 점으로 구분한 레이블 연속
- 루트
    - 크기가 0인 Null 레이블 소유
- 공식표기(fully qualified domain name) 시 마지막에 점을 붙여야함
    - 점이 없는 경우 호스트의 default domain이 기본적으로 붙음
    - www.korea.co.kr ---> www.korea.co.kr.korea.co.kr.으로 해석
- 도메인
    - 계층적 구조
    - 같은 레벨에서는 레이블 유일해야함
    - 도메인 이름
        - 최하위레이블을 왼쪽에 위치
        - 상위로 이동하면서 레이블 표기
        - xx.ajou.ac.kr
    - TLD(top level domain)
        - 최상위도메인
        - 루트 바로 밑에 위치한 레이블
        - ex) edu, arpa
    - 도에인
        - edu 도메인
        - mit.edu 도메인
---
### 데이터베이스 서비스
- 인터넷 도메인 네임 스페이스를 계층구조로 분할
- 하나의 개념적인 저장장소를 소유 ---> 실제로는 각 하부 도메인을 관리하는 호스트에 이름, 주소관리 권한 위임
- 권한 위임을 받은 도메인 관리서버는 자신의 도메인에 포함된 모든 레이블(호스트, 하부 도메인)에 관한 정보를 적절히 유지해야함
- 다른 도메인에 속한 호스트의 정보 ---> 해당 도메인을 관리하는 네임서버로부터 얻어냄
- 존(zone)
    - 임의의 네임버서가 관리하는 영역
    - 도메인과 유사하지만 다름
---
### 자원레코드
- 이름과 주소정보 등을 저장하기 위한 레코드
- 트리에 연결된 각 호스트의 정보는 자원 레코드와 관련됨
- DNS 네임서버가 해석기에 반환하는 데이터 = 자원레코드 정보
- 질의레코드
    - DNS 클라이언트가 DNS서버에 정보를 요청하는 용도
- 필드
    - name
        - 찾고자 하는 가변길이의 도메인 이름
    - type
        - 자원 종류
            - A(address)
                - 호스트 IP주소
                - 도메인이름, IP주소 변환
            - NS(name server)
                - 도메인을 관장하는 인증된 네임서버
            - CNAME(canonical name)
                - 호스트별명
            - SOA(start of authority)
                - 존의 시작 표시
            - WKS(well-known services)
                - 호스트가 제공하는 네트워크 서비스
            - PTR(pointer)
                - IP주소를 도메인 이름으로 변환
            - HINFO(host information)
                - 호스트정보
            - MX(mail eXchange)
                - 메일 교환
                - 특정메일주소로 전송된 메일을 다른 주소로 재전송(redirect)
            - 기타
                - SIG(security signature)
                - NXT(next domain)
                - AAAA(IPv6주소)
                - TXT(text)....
    - class
        - 프로토콜 패밀리
        - 인터넷 = IN
    - TTL
        - time to live
        - 캐시에 저장된 정보 유효기간
    - RD length
        - RD크기
    - RD(resource data)
        - 자원데이터
---
---
# ----네임서버----
### 호스트이름 ---> IP주소로 변환과정
- 응용프로그램이 해석기라고 부르는 DNS클라이언트에게 정보제공 요청
- 해석기
    - 해석기가 DNS메시지 형식의 질의생성
    - 이 질의를 네임서버에 전달
    - 네임서버는 회신용 DNS메시지에 결과를 담아 해석기에 회신
- 네임서버 부담을 줄이기 위해 캐시정보 활용
    - 인증데이터
        - 해당데이터를 직접 관리할 책임있는 네임서버로부터 받은 정보
    - 캐시데이터
        - 이전요청에 의해 호스트가 보관하던 정보
    - TTL(time to live)동안 유효 ---> 이 시간을 넘어가면 캐시정보 삭제 ---> 네임서버에 요청
- 존(zone)
    - 자원레코드에 포함된 인증데이터 집합체로 정의
    - 관리하는 정보
        - 존에 속하는 모든 호스트의 전체 자원레코드 집합체
        - 존에 포함된 최상위 호스트
        - 위임서브존
            - 자신의 존에 속하지만 인증이 위임된 경우
        - 위임된 서버존에 관한 글루(glue) 데이터
            - 서브존의 네임서버에 접근할 수 있도록 해줌
    - ex) test.info.mit.edu의 호스트 정보를 얻고자 하는 경우
        - info.mit.edu를 관리하는 네임서버의 IP주소를 알면 간단히 처리
        - info.mit.edu의 네임서버가 서브존 도메인내부에 위치하여 IP주소를 얻기 곤란한 경우 글루데이터 필요 ---> 담당하는 네임서버의 주소 필요
---
### 요청의 처리
- 호스트A가 호스트B의 정보를 원할 때 호스트 A,B가 
    - 같은 도메인에 위치 ---> 이 도메인의 네임서버가 인증데이터 회신
    - 다른 도메인에 위치 ---> 인근 네임서버에게 요청, 호스트A를 중개
- 인근 네임서버를 찾는 작업은 인증정보를 찾을 때까지 반복
- 질의요청이 처리되는 과정
    1. 인증 데이터가 반드시 필요한지 명시(혹은 캐시)
    2. 해석기는 질의 요청을 재귀적으로 처리해야 하는 지 명시(혹은 비재귀적)
        - 재귀적요청
            - 해석기가 최초로 접속을 시도한 네임서버가 질의요청을 춱, 관리
            - 재귀적 요청을 받은 네임서버 = 결과적으로 해석기역할
        - 비재귀적요청
            - 요청을 받은 네임서버가 다른 네임서버의 포인터정보 회신
            - 이를 받은 해석기는 다른 네임서버에게 다시 질의
---
---
# ----DNS프로토콜----
### DNS메시지
- 구성
    - header
        - 12바이트
        - 헤더 값 ---> 메시지 각 필드 사용결정
        - identification
            - 요청, 응답의 연관관계 확인용도
        - QR(query response)
            - 질의메시지 = 1
            - 응답메시지 = 0
        - opcode
            - 질의, 응답 종류
            - 표준 = 0
            - 반대 = 1
            - 서버상태요청 = 2
        - AA(authoritative answer)
            - 인증권한이 있는 네임서버 여부
            - 응답 전용
        - TC(truncated)
            - UDP 최대크기 초과여부
            - 1로 설정 ---> 초과 ---> TCP로 재요청 필요
        - RD(recursive desired)
            - 재귀적 응답요청
            - 질의전용
        - RA(recursion available)
            - 재귀응답 가능여부
            - 응답 전용
        - QCOUNT, ANCOUNT, AUCOUNT, ARCOUNT
            - n(각 자원 레코드)
    - question
        - 질의메시지, 응답메시지 모두 사용
        - 질의레코드
    - answer, authority, additional
        - 자원레코드 사용
        - 응답에서 추가적으로 사용
---
### UDP 패킷크기로 인한 제약
- 해석기와 네임서버는 기본적으로 UDP 53번포트로 DNS메시지 전송
- UDP프로토콜 최대 전송크기 = 512바이트
- TCP 53번 포트를 사용하는 경우
    - 미리 512바이트보다 크다는 것을 인지하는 경우 ---> 처음부터 TCP 사용
    - 사전에 인지X ---> TC=1로 지정 ---> TCP사용하여 재질의
- IPv4 ---> UDP 사용 일반적
- IPv6(주소크기 증가, 기본적으로 복수개 주소 소유 가능), DNSSEC(보안강화) ---> UDP크기 제한 넘어갈 수 있음 ---> TCP를 사용할 수 밖에 없음

