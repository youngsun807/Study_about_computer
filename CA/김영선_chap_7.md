## **7.1 시스템버스**
> 컴퓨터 시스템 구성요소들을 상호 연결해주는 중심 통로
### **<버스>**
> 각종 정보들 전송하는 선
- 버스선의 수
    - 한번에 전송하는 데이터 비트수, 기억장치 주소비트들의 수, 제어신호들의 수에 따라 결정
    - 소형 : 100개
    - 중대형급 : 100개 이상 신
- 종류
    1. 데이터 버스
        - 데이터 전송
        - 양방향 전송
        - 버스 폭(선들의 수)
            > CPU와 기억장치 사이에 한번에 전송되는 비트수
    2. 주소 버스
        - CPU와 기억장치 사이에서 데이터 읽기, 쓰기 시 기억장소 지정하는 주소 전송
        - 단방향 전송
        - 주소 버스의 비트수에 의해 전체 기억장치 용량 결정
        - 주소지정 단위 : 바이트, 단어
    3. 제어 버스
        - 제어신호 전송하는 선들의 집합
        - 단방향 전송
        - 신호 종류
            1. 기억장치 쓰기, 읽기 ---> CPU에서 장치로
            2. I/O 쓰기, 읽기 ---> CPU에서 장치로
            3. 전송확인 ---> 장치에서 CPU로
    4. 중재버스
        > 버스 중재를 위한 신호 선들의 집합
        - 여러 장치가 하나의 버스 사용 요청 ---> 충돌 ---> 그 사이에서 중재, 관재
        - 버스마스터 
            - 시스템 버스에 접속되는 요소 중 버스 사용의 주체가 되는 요소들
            - CPU, 기억장치모듈, I/O제어기
        - 버스 중재
            - 장치들이 동시에 버스 사용하고자 할 때 순서 정함
        - 신호 종류
            1. 버스 요구
            2. 버스 승인
            3. 버스 사용중
    5. 인터럽트 버스
        > 인터럽트 메커니즘을 위한 제어 신호선들의 집합
        - 제어 신호 종류
            1. 인터럽트 요구
            2. 인터럽트 확인
            3. 버스 클럭
            4. 리셋
- 버스 대역폭
    - 버스 속도
        > 단위 시간당 전송할 수 있는 데이터 양
- 버스 동작 타이밍에 따른 분류
    - 동기식 버스
        - 모든 버스 동작들이 공통 버스클럭을 기준으로 발생
        - 빠른 장치에서 사용(중형급)
        - 장점
            - 회로 간단
            - 클럭 주기 짧음
        - 단점
            - 클럭 주기 길면 사용X
    - 비동기식 버스
        - 버스 동작들의 발생시간이 관련된 다른 버스 동작의 발생여부에 따라 결정
        - 소규모 컴퓨터에서 사용
        - 장점
            - 연속적으로 일어나 시간낭비X
        - 단점
            - 회로 복잡
            - 클럭 스피드 빠르면 연관적으로 일어나기 어려움
---
## **7.2 버스중재**
- 버스 경합
    > 동시에 버스 요구
- 버스 중재
    > 버스 경합 발생시, 순서대로 사용하게 해줌
- 버스 중재기
    > 버스 중재하는 하드웨어 모듈
- 중재방식 분류
    - 병렬식
        > 버스 마스터들 수 = 버스 요구 선, 신호선
        - 우선순위 결정방식에 따라
            1. 고정 우선순위
                > 버스 마스터에 지정된 우선순위 고정
                - 중앙집중식 고정 우선순위
                - 분산식 고정 우선순위
            2. 가변 우선순위
                > 기아현상을 해결할 수 있다.
                > 우선순위 변경 가능
                - 장점
                    - 공정하게 버스 사용
                - 단점
                    - 중재 회로 복잡
                - 종류
                    1. 회전 우선순위 방식
                    2. 임의 우선순위 방식
                    3. 동등 우선순위 방식
                    4. 최소 최근 사용방식
    - 직렬식
        > 버스 요구, 승인선이 한 개
        - 누가 신호를 보냈는지 구별하기 어려움
        - 종류
            - 중앙집중식 직렬 중재방식
                - 데이지 체인형태(목걸이같이 연결된 순서대로)
            - 분산식 직렬중재
                - 데이지 체인 버스 승인 신호가 순환형으로 접속
                - 단점
                    - 한 지점에 결함 발생 --> 전체 시스템 중단
- 중재기 위치에 따른 분류
    - 중앙집중식
        - 버스 중재기 한개만 존재
    - 분산식 
        - 버스 중재기 나눔 --> 버스 마스터들마다 중재기 필요 --> 컨트롤하기 어려움
        - 사용X
- 폴링 방식
    - 마스터가 있는지 버스 중재기가 주기적으로 검사하여 사용 승인 여부 결정
    - 종류
        1. H/W 폴링
            > 버스 중재기와 각 마스터간에 별도 폴링선 존재
            - 공통의 BREQ선 : BBUSY선  = 1:1
            - 우선순위 결정방법
                1. 순서대로
                2. 2진 카운터
            - 속도가 느린 장치들에 대해서 좋은 방식
            - 단점
                - 마스터마다 중재기 존재 ---> 일일이 검사 ---> 시간 오래걸림 ---> 버스 중재기 복잡함
        2. S/W 폴링
            > 폴링 순서, 과정을 버스 중재기내의 프로세서가 관장
            - 장점
                - 우선순위 변경 용이
            - 단점
                - 프로그램 실행 필요 ---> H/W 방식에 비해 느림
---
## **7.3 I/O장치의 접속**
### **<I/O 제어>**
- 시스템 버스에 직접 접속X ---> I/O제어기(controller) 사용
```
<직접 접속하지 않는 이유>
- 입출력 종류가 많음 ---> 제어 방법이 서로 다름
- 모든 회로를 CPU 내부에 포함 불가능
- 데이터 전송 속도가 CPU 속도보다 매우 느림
- 데이터 형식, 길이가 다른 경우 많음
```
- 기능
    - I/O 장치 제어, 타이밍 조정
    - CPU와 통신 담당
    - I/O 장치와 통신 담당
    - 데이터 버퍼링 수행
    - 오류 검출
- 상태/제어 레지스터
    - 주소는 하나만 지정
    - 상태
        - I/O 장치 상태, 오류검사 결과등을 나타내는 비트들로 구성
    - 제어
        - CPU가 보낸 I/O 명령단어 저장
- 프로그램 이용한 I/O
    - CPU가 반복적으로 I/O 장치 상태 검사, 동작 처리
    - 장점
        - 간단
        - 별도 H/W 필요X
    - 단점
        - CPU가 I/O 동작에 직접 관여 --> 그동안 다른 일 못함
- I/O 주소지정
    - 각 I/O 장치당 두개씩 주소 할당
    - 지정방법
        - 기억장치-mapped
            - 기억장치 일부를 I/O 제어기내의 레지스터들 주소로 할당
            - 프로그래밍에서 기억장치 관련 명령어를 I/O 장치 제어에도 사용가능
            - 기억장치 읽기/쓰기 신호를 I/O 읽기/쓰기 신호로 사용
            - 장점
                - 프로그래밍 용이
            - 단점
                - 기억장치 주소공간 감소
        - 분리형
            - I/O 주소공간을 기억장치 주소공간과 별도로 할당
            - I/O 제어 ---> 별도의 I/O 명령어 사용
            - 장점
                - 기억장치 주소공간 줄지 않음
            - 단점
                - 프로그래밍 불편
---
## **7.4 인터럽트를 이용한 I/O**
### **<인터럽트 구동 I/O>>**
> I/O 동작이 진행되는 동안 CPU가 다른 작업을 처리할 수 있도록 하는 방식
- 구현방법
    1. 다중 인터럽트
        - 각 제어기와 CPU 사이에 별도의 인터럽트 요구, 확인 선을 접속
        - 장점
            - 인터럽트를 요구한 장치를 쉽게 찾을 수 있음
        - 단점
            - H/W 복잡
            - 접속 가능 I/O 장치들 수 = 인터럽트 요구 입력핀의 수 ---> 제한
    2. 데이지 체인
        - USB 방식과 비슷
        - 인터럽트가 직렬로 연결
        - 인터럽트 요구 ---> 인터럽트 벡터(자신의 고유번호)를 CPU에 전송
        - 장점
            - H/W 간단
        - 단점
            - 중간에서 우선순위가 높은 장치들이 신호를 가로챔
            - 우선순위가 낮은 장치들은 서비스를 받지 못하고 오래 기다림
    3. S/W 폴링
        - 인터럽트를 요구한 장치를 검사
        - 일일이 CPU가 검사하는 방식
        - 제어기는 CPU가 명령을 보낼 때까지 아무것도 요청을 보내지 않음 ---> 수동적
        - 장점
            - 우선순위 변경 용이
        - 단점
            - 처리시간 오래걸림
---
## **7.5 직접기억장치엑세스(DMA)**
> 입출력 동작에 개입없이 I/O 장치와 기억장치 사이에 데이터 전송하는 방식(cycle stealing)
- CPU가 내부작업을 할 때 주기억장치와 I/O 장치간에 데이터 전송 <--- 시스템 버스 이용
- 문제점
    - 각 데이터 전송때마다 시스템 버스 2번씩 사용 ---> 버스 사용량 증가 --> 시스템 성능 저하
- 해결책
    1. I/O 장치들을 DMA 제어기로 접속
        - 문제점 
            - I/O 장치 종류/속도 다양, 제어방법 복잠 ---> DMA 제어기로 지원하는데 한계有
            - 디스크 W/R ---> 데이터 블록 크기 512byte 이상 --> 버퍼링 위한 내부 기억장치 필요
        - 해결책
            - I/O 프로세서(IOP) 사용 = I/O 채널
                - 포함될 요소
                    - 프로세서
                        - I/O 명령어들을 실행
                    - 지역기억장치
                        - 데이터 블록 임시저장
                    - 시스템버스 인터페이스
                    - 버스 마스터 회로
                    - I/O 버스 중재회로
    2. I/O 버스 사용
---
## **7.6 외부버스**
1. parallel ATA
    - IDE, EIDE ---> 간섭, 왜곡 발생 ---> serial ATA(SATA, 현재 쓰는 방식) --> 안정적
    - 한 케이블에 여러개(2개) 장치 연결
    - master, slave 구분
2. SATA
    - 내부 장치와는 연결 안하는 것이 좋음
3. USB
> 외부장치를 연결하는 표준 직렬버스
```
전통적인 PC로부터 자유로워지기 위해
- 인터럽트 개수 제한 ---> 연결 장치 제한
- 케이블 모양이 다 다름
- 각 장치마다 인터페이스 필요
- 한번 설치하면 그 다음부터 리부팅 필요X
```
- 비대칭적 구조 ---> 여러개 데이지 체인
- 여러 개 USB 허브 추가 가능
- 트리 구조 허용
- 컨트롤러당 최대 5단계까지 제한
- 1개 호스트 컨트롤러 최대 127대 장치 연결 가능(버스 포함)
- 종단장치 필요X
